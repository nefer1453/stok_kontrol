<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stok Kontrol Motoru</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto;margin:0;background:#f8fafc}
main{max-width:520px;margin:auto;padding:16px}
input{flex:1;padding:14px;font-size:16px;border:1px solid #ddd;border-radius:14px}
button{padding:12px 16px;border:0;border-radius:14px;background:#16a34a;color:#fff;font-weight:700}
.row{display:flex;gap:10px;margin-bottom:16px}
.card{background:#fff;padding:14px;border-radius:14px;margin-bottom:12px;border:1px solid #e5e7eb}
.small{font-size:12px;color:#64748b}
.actions{display:flex;gap:8px;margin-top:10px}
.actions button{flex:1}
</style>
</head>
<body>
<main>
<h2>Stok Kontrol Motoru</h2>
<div class="small">v0.3 — Hareket motoru aktif</div>

<div class="row">
  <input id="prodName" placeholder="Ürün adı">
  <button onclick="addProduct()">Ekle</button>
</div>

<div id="list"></div>
</main>

<script>
const KEY="stok_kontrol_v3";
const $=id=>document.getElementById(id);

let db=JSON.parse(localStorage.getItem(KEY)||"null")||{
  products:[],
  ops:[]
};

function save(){
  localStorage.setItem(KEY,JSON.stringify(db));
}

function stockOf(productId){
  return db.ops
    .filter(o=>o.productId===productId)
    .reduce((t,o)=>t+o.qty,0);
}

function addProduct(){
  const name=$("prodName").value.trim();
  if(!name){ alert("Ürün adı yaz."); return;}
  db.products.push({
    id:Date.now().toString(16),
    name
  });
  $("prodName").value="";
  save();
  render();
}

function addOp(productId, qty, reason){
  db.ops.push({
    id:Date.now().toString(16),
    productId,
    qty,
    reason,
    ts:Date.now()
  });
  save();
  render();
}

function render(){
  const box=$("list");
  box.innerHTML="";
  db.products.forEach(p=>{
    const stock=stockOf(p.id);
    const el=document.createElement("div");
    el.className="card";
    el.innerHTML=`
      <b>${p.name}</b>
      <div class="small">Stok: ${stock}</div>
      <div class="actions">
        <button onclick="chooseIncrease('${p.id}')">Artış</button>
        <button onclick="chooseDecrease('${p.id}')">Azalış</button>
      </div>
    `;
    box.appendChild(el);
  });
}

function chooseIncrease(id){
  const type=prompt("Artış sebebi:\n1-Sipariş\n2-Dağılım");
  if(type==="1"){
    addOp(id,1,"sipariş");
  }else if(type==="2"){
    addOp(id,1,"dağılım");
  }
}

function chooseDecrease(id){
  const type=prompt("Azalış sebebi:\n1-Satış\n2-SKT\n3-İade");
  if(type==="1"){
    addOp(id,-1,"satış");
  }else if(type==="2"){
    addOp(id,-1,"skt");
  }else if(type==="3"){
    addOp(id,-1,"iade");
  }
}

render();
</script>
</body>
</html>
