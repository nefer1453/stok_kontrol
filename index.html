<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stok Kontrol Motoru</title>
<style>
body{font-family:system-ui;margin:0;background:#f8fafc}
main{max-width:520px;margin:auto;padding:16px}
h2{margin:0 0 10px}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:14px;margin-bottom:12px}
button{padding:10px 14px;border-radius:12px;border:0;background:#16a34a;color:white;font-weight:700}
select,input{padding:10px;border-radius:10px;border:1px solid #ddd;width:100%;margin-bottom:8px}
.small{font-size:12px;color:#64748b}
</style>

<script>
/* FOCUS_GUARD_V1 */
function safeFocus(el){
  try{
    if(!el) return;
    // klavye/viewport zıplamasını azaltır
    el/* focus disabled */
  }catch(e){
    try{ el && el/* focus disabled */ }catch(_){}
  }
}
// Global: otomatik focus'u varsayılan kapalı tut
let AUTO_FOCUS = false;
</script>

</head>
<body>
<main>
<h2>Stok Kontrol Motoru</h2>

<div class="card">
<input id="prodInput" placeholder="Ürün adı">
<button onclick="addProduct()" type="button">Ürün Ekle</button>
</div>

<div id="products"></div>

</main>

<script>
const KEY="stok_motor_v3"
let db=JSON.parse(localStorage.getItem(KEY)||"null")||{products:[],events:[]}

function save(){
localStorage.setItem(KEY,JSON.stringify(db))
}

function addProduct(){
const name=document.getElementById("prodInput").value.trim()
if(!name) return
db.products.push({id:Date.now(),name})
save()
document.getElementById("prodInput").value=""
render()
}

function addEvent(prodId){
const type=document.getElementById("type_"+prodId).value
const qty=parseInt(document.getElementById("qty_"+prodId).value||0)

if(!qty) return

db.events.push({
id:Date.now(),
prodId,
type,
qty,
ts:Date.now()
})

save()
render()
}

function calculateStock(prodId){
let total=0
db.events.forEach(e=>{
if(e.prodId===prodId){
if(e.type==="siparis"||e.type==="dagilim") total+=e.qty
if(e.type==="eksilme") total-=e.qty
}
})
return total
}

function render(){
const box=document.getElementById("products")
box.innerHTML=""

db.products.forEach(p=>{
const stock=calculateStock(p.id)

box.innerHTML+=`
<div class="card">
<b>${p.name}</b>
<div class="small">Stok: ${stock}</div>

<select id="type_${p.id}">
<option value="siparis">Sipariş (+)</option>
<option value="dagilim">Dağılım (+)</option>
<option value="eksilme">Eksilme (-)</option>
<option value="fiyat">Fiyat İsteme (0)</option>
</select>

<input id="qty_${p.id}" type="number" placeholder="Miktar">

<button onclick="addEvent(${p.id})" type="button">İşlem Ekle</button>
</div>
`
})
}

render()
</script>

<script>
/* SUBMIT_GUARD_V1 */
(function(){
  // Herhangi bir form submit'i asla sayfayı yenilemesin
  window.addEventListener("submit", function(e){
    e.preventDefault();
    e.stopPropagation();
    return false;
  }, true);
})();
</script>

</body>
</html>
